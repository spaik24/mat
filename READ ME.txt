Все решения были взяты у одногрупников, но я честно разобрался во всём коде. 
Если это слишком критично, осмелсь попросить отсрочку в пару днец и попробую переписать полностью по другому (если это являеться возможным)
Признаюсь честно, потому что отрицать это не имеет смысла, так как это видно сразу.
 